
# parallel

rm(list=ls())
source("/Users/jdavin/Dropbox/greatschools - share/JosephDavin/R-all California/getdetails.R")
library(stringr) # for str_locate
library(doSNOW)
library(foreach)

state="california"
outdircities="/Users/jdavin/Dropbox/greatschools - share/data/reviewsdetailed/notla/cities/"
outdirreviews="/Users/jdavin/Dropbox/greatschools - share/data/reviewsdetailed/notla/reviews/"

# gradeLevels=e, p, m, or h
# or st= public, charter, or private

#end="st=public"
#end="gradeLevels=e"
end="st=public&st=charter&st=private"


notlacities=c("Acampo","Acton","Adelanto","Aguanga","Ahwahnee","Alameda","Alamo","Albany","Albion","Aliso-Viejo","Alpaugh","Alpine","Alta-Loma","Altadena","Alturas","Alviso","American-Canyon","Anaheim","Anderson","Angels-Camp","Angelus-Oaks","Angwin","Annapolis","Antelope","Antioch","Anza","Apple-Valley","Aptos","Arbuckle","Arcata","Armona","Arnold","Aromas","Arroyo-Grande","Arvin","Atascadero","Atherton","Atwater","Auberry","Auburn","Avenal","Avery","Badger","Baker","Bakersfield","Ballico","Bangor","Banning","Barstow","Bayside","Beale-AFB","Beaumont","Beckwourth","Bella-Vista","Belmont","Benicia","Benton","Berkeley","Berry-Creek","Bieber","Big-Bar","Big-Bear-City","Big-Bear-Lake","Big-Bend","Big-Creek","Big-Pine","Big-Sur","Biggs","Bishop","Blocksburg","Bloomington","Blue-Lake","Blythe","Bodega-Bay","Bolinas","Bonita","Bonsall","Boonville","Boron","Borrego-Springs","Boulder-Creek","Boulevard","Bradley","Brawley","Brea","Brentwood","Bridgeport","Bridgeville","Brisbane","Browns-Valley","Brownsville","Buellton","Buena-Park","Burlingame","Burney","Burnt-Ranch","Buttonwillow","Byron","Cabazon","Calexico","Caliente","California-City","California-Hot-Springs","Calimesa","Calipatria","Calistoga","Calpella","Camarillo","Cambria","Camino","Campbell","Campo","Camptonville","Canby","Canoga-Park","Cantua-Creek","Canyon-Country","Capitola","Cardiff-By-The-Sea","Carlotta","Carlsbad","Carmel","Carmel-Valley","Carmichael","Carpinteria","Caruthers","Cassel","Castaic","Castella","Castro-Valley","Castroville","Cathedral-City","Cayucos","Cazadero","Cedar-Glen","Cedarville","Ceres","Challenge","Chatsworth","Chester","Chico","Chinese-Camp","Chino","Chino-Hills","Chowchilla","Chualar","Chula-Vista","Citrus-Heights","Clarksburg","Clayton","Clearlake","Cloverdale","Clovis","Coachella","Coalinga","Coarsegold","Cobb","Coleville","Colfax","Colton","Columbia","Colusa","Comptche","Concord","Cool","Copperopolis","Corcoran","Corning","Corona-del-Mar","Coronado","Corte-Madera","Costa-Mesa","Cotati","Cottonwood","Coulterville","Courtland","Covelo","Crescent-City","Crestline","Creston","Crockett","Crows-Landing","Cupertino","Cutler","Cypress","Daggett","Daly-City","Dana-Point","Danville","Davenport","Davis","Death-Valley","Del-Rey","Delano","Delhi","Denair","Descanso","Desert-Center","Desert-Hot-Springs","Diamond-Springs","Dinuba","Discovery-Bay","Dixon","Dobbins","Dorris","Dos-Palos","Douglas-City","Downieville","Doyle","Dublin","Ducor","Dunlap","Dunsmuir","Durham","Earlimart","East-Irvine","Edwards-AFB","El-Cajon","El-Centro","El-Dorado","El-Dorado-Hills","El-Granada","El-Nido","El-Portal","El-Sobrante","Elk-Creek","Elk-Grove","Elmira","Elverta","Emeryville","Emigrant-Gap","Empire","Encinitas","Encino","Escalon","Escondido","Esparto","Etna","Eureka","Exeter","Fair-Oaks","Fairfax","Fairfield","Fall-River-Mills","Fallbrook","Farmersville","Farmington","Fellows","Felton","Ferndale","Fillmore","Firebaugh","Five-Points","Flournoy","Folsom","Fontana","Foothill-Ranch","Forest-Falls","Forest-Ranch","Foresthill","Forestville","Forks-of-Salmon","Fort-Bragg","Fort-Irwin","Fort-Jones","Fortuna","Fountain-Valley","Fowler","Frazier-Park","Freedom","Fremont","French-Camp","French-Gulch","Fresno","Fullerton","Galt","Garberville","Garden-Grove","Garden-Valley","Gasquet","Gazelle","Georgetown","Gerber","Geyserville","Gilroy","Glen-Ellen","Glenn","Glennville","Goleta","Gonzales","Granada-Hills","Grand-Terrace","Granite-Bay","Grass-Valley","Graton","Greenfield","Greenville","Greenwood","Grenada","Gridley","Grimes","Grizzly-Flat","Groveland","Grover-Beach","Guadalupe","Guerneville","Gustine","Hacienda-Heights","Half-Moon-Bay","Hamilton-City","Hanford","Happy-Camp","Harbor-City","Hayfork","Hayward","Healdsburg","Heber","Helendale","Helm","Hemet","Herald","Hercules","Herlong","Hesperia","Hickman","Highland-Park","Hilmar","Hinkley","Hollister","Holtville","Honeydew","Hoopa","Hornbrook","Hughson","Hume","Huntington-Beach","Huron","Hyampom","Hydesville","Idyllwild","Igo","Imperial-Beach","Independence","Indian-Wells","Indio","Inverness","Inyokern","Ione","Irvine","Isleton","Ivanhoe","Jackson","Jacumba","Jamestown","Jamul","Janesville","Johannesburg","Joshua-Tree","Julian","Junction-City","June-Lake","Keene","Kelseyville","Kentfield","Kenwood","Kerman","Kernville","Kettleman-City","Keyes","King-City","Kings-Beach","Kingsburg","Klamath","Kneeland","Knights-Landing","Knightsen","Korbel","Kyburz","La-Canada-Flintridge","La-Crescenta","La-Grange","La-Habra","La-Honda","La-Jolla","La-Mesa","La-Palma","La-Quinta","Ladera-Ranch","Lafayette","Laguna-Beach","Laguna-Hills","Laguna-Niguel","Lake-Arrowhead","Lake-Elsinore","Lake-Forest","Lake-Hughes","Lake-Isabella","Lakeport","Lakeside","Lamont","Landers","Larkspur","Lathrop","Laton","Laytonville","Le-Grand","Lebec","Lee-Vining","Leggett","Lemon-Cove","Lemon-Grove","Lemoore","Lewiston","Lincoln","Linden","Lindsay","Litchfield","Littlerock","Live-Oak","Livermore","Livingston","Llano","Lockeford","Lockwood","Lodi","Loleta","Loma-Linda","Lompoc","Lone-Pine","Long-Barn","Loomis","Los-Alamitos","Los-Alamos","Los-Altos","Los-Banos","Los-Gatos","Los-Molinos","Los-Olivos","Los-Osos","Lost-Hills","Lower-Lake","Loyalton","Lucerne","Lucerne-Valley","Macdoel","Madison","Magalia","Mammoth-Lakes","Manchester","Manteca","Manton","Maricopa","Marina","Marina-del-Rey","Mariposa","Markleeville","Martinez","Marysville","Mather","Maxwell","McArthur","McClellan","McCloud","McFarland","McKinleyville","McKittrick","Meadow-Vista","Mecca","Mendocino","Mendota","Menifee","Menlo-Park","Mentone","Merced","Meridian","Middletown","Midway-City","Mill-Valley","Millbrae","Millville","Milpitas","Mineral","Mira-Loma","Miranda","Mission-Hills","Mission-Viejo","Modesto","Mojave","Mokelumne-Hill","Montague","Montara","Montclair","Monte-Rio","Montgomery-Creek","Montrose","Moorpark","Moraga","Moreno-Valley","Morgan-Hill","Morongo-Valley","Morro-Bay","Moss-Landing","Mount-Aukum","Mount-Shasta","Mountain-Center","Mountain-Ranch","Mountain-View","Murphys","Murrieta","Napa","National-City","Needles","Nevada-City","New-Cuyama","Newark","Newberry-Springs","Newbury-Park","Newcastle","Newhall","Newman","Newport-Beach","Nicasio","Nicolaus","Niland","Nipomo","Norco","Norden","North-Fork","North-Highlands","North-Hills","North-Hollywood","Northridge","Novato","Nuevo","O'Neals","Oak-Park","Oak-Run","Oak-View","Oakdale","Oakhurst","Oakland","Oakley","Occidental","Oceano","Oceanside","Ojai","Olivehurst","Olympic-Valley","Ontario","Orange-Cove","Orangevale","Oregon-House","Orick","Orinda","Orland","Orleans","Oro-Grande","Orosi","Oroville","Oxnard","Pacific-Grove","Pacific-Palisades","Pacifica","Pacoima","Paicines","Pala","Palermo","Palm-Desert","Palm-Springs","Palo-Alto","Palo-Cedro","Panorama-City","Paradise","Parlier","Paskenta","Paso-Robles","Patterson","Pauma-Valley","Paynes-Creek","Pearblossom","Pebble-Beach","Penn-Valley","Penngrove","Penryn","Perris","Pescadero","Petaluma","Petrolia","Phelan","Philo","Piedmont","Pine-Grove","Pine-Valley","Pinecrest","Pinole","Pinon-Hills","Pioneer","Piru","Pismo-Beach","Pittsburg","Pixley","Placentia","Placerville","Planada","Platina","Playa-del-Rey","Pleasant-Grove","Pleasant-Hill","Pleasanton","Plymouth","Point-Arena","Point-Reyes-Station","Pollock-Pines","Pope-Valley","Port-Hueneme","Porter-Ranch","Porterville","Portola","Potrero","Potter-Valley","Poway","Prather","Princeton","Quincy","Rail-Road-Flat","Raisin-City","Ramona","Rancho-Cordova","Rancho-Cucamonga","Rancho-Mirage","Rancho-Santa-Fe","Rancho-Santa-Margarita","Raymond","Red-Bluff","Redding","Redlands","Redway","Redwood-City","Redwood-Valley","Reedley","Rescue","Reseda","Rialto","Richgrove","Richmond","Ridgecrest","Rio-Dell","Rio-Linda","Rio-Oso","Rio-Vista","Ripon","Riverbank","Riverdale","Riverside","Robbins","Rocklin","Rodeo","Rohnert-Park","Rosamond","Roseville","Ross","Rowland-Heights","Running-Springs","Sacramento","Salida","Salinas","Salton-City","Samoa","San-Andreas","San-Anselmo","San-Ardo","San-Bernardino","San-Bruno","San-Carlos","San-Clemente","San-Diego","San-Francisco","San-Geronimo","San-Jacinto","San-Joaquin","San-Jose","San-Juan-Bautista","San-Juan-Capistrano","San-Leandro","San-Lorenzo","San-Lucas","San-Luis-Obispo","San-Marcos","San-Martin","San-Mateo","San-Miguel","San-Pablo","San-Pedro","San-Rafael","San-Ramon","San-Ysidro","Sanger","Santa-Ana","Santa-Barbara","Santa-Clara","Santa-Cruz","Santa-Maria","Santa-Paula","Santa-Rosa","Santa-Ynez","Santa-Ysabel","Santee","Saratoga","Sausalito","Scotia","Scotts-Valley","Seal-Beach","Seaside","Sebastopol","Seeley","Seiad-Valley","Selma","Shafter","Shandon","Shasta-Lake","Shaver-Lake","Sheridan","Sherman-Oaks","Shingle-Springs","Shingletown","Shoshone","Sierraville","Silverado-Canyon","Simi-Valley","Sloughhouse","Smith-River","Snelling","Solana-Beach","Soledad","Solvang","Somerset","Somes-Bar","Somis","Sonoma","Sonora","Soquel","Soulsbyville","South-Dos-Palos","South-Lake-Tahoe","South-San-Francisco","Spreckels","Spring-Valley","Springville","Squaw-Valley","Stanford","Stanton","Stevenson-Ranch","Stevinson","Stewarts-Point","Stinson-Beach","Stockton","Stonyford","Stratford","Strathmore","Studio-City","Sugarloaf","Suisun-City","Summerland","Sun-City","Sun-Valley","Sunland","Sunnyvale","Sunol","Susanville","Sutter-Creek","Sylmar","Taft","Tahoe-City","Tarzana","Taylorsville","Tecate","Tecopa","Tehachapi","Temecula","Templeton","Termo","Terra-Bella","Thermal","Thornton","Thousand-Oaks","Thousand-Palms","Three-Rivers","Tipton","Tollhouse","Tomales","Topanga","Trabuco-Canyon","Tracy","Tranquillity","Traver","Travis-AFB","Tres-Pinos","Trinidad","Trinity-Center","Trona","Truckee","Tujunga","Tulare","Tulelake","Tuolumne","Tupman","Turlock","Tustin","Twain-Harte","Twentynine-Palms","Twin-Peaks","Ukiah","Union-City","Upland","Upper-Lake","Vacaville","Valencia","Vallecito","Vallejo","Valley-Center","Valley-Springs","Valley-Village","Van-Nuys","Venice","Ventura","Victor","Victorville","Villa-Park","Vina","Visalia","Warner-Springs","Wasco","Washington","Waterford","Watsonville","Weaverville","Weed","Weimar","Weldon","Weott","West-Hills","West-Point","West-Sacramento","Westley","Westminster","Westmorland","Westwood","Wheatland","White-Water","Whitethorn","Whitmore","Wildomar","Williams","Willits","Willow-Creek","Willows","Wilmington","Wilton","Winchester","Windsor","Winnetka","Winterhaven","Winters","Winton","Woodbridge","Woodlake","Woodland-Hills","Woody","Wrightwood","Yermo","Yettem","Yolo","Yorba-Linda","Yountville","Yreka","Yuba-City","Yucaipa","Yucca-Valley","Zenia")

reviews_all_cities=c()
details_all_cities=c()


registerDoSNOW(makeCluster(4))


foreach(i=1:length(notlacities),.combine='rbind', .packages=c("stringr")) %dopar% {

	# get lines that contain cities
	currentcity = notlacities[i]
	# get data and reviews
	data=getdetails(state,currentcity,today="November 25, 2013", yesterday="November 24, 2013")
	reviews_all_cities=rbind(reviews_all_cities,data[[1]])
	details_all_cities=rbind(details_all_cities,data[[2]])
	cat("Done with city",currentcity,"\n")
	
	write.csv(data[[1]],paste(outdirreviews,"reviews-",state,"-",currentcity,".csv",sep=""))
	write.csv(data[[2]],paste(outdircities,"1_",state,"-",currentcity,".csv",sep=""))
}


